{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard - Sistema PMCELL{% endblock %}

{% block extra_head %}
<script src="{% static 'js/dashboard.js' %}" defer></script>
<script src="{% static 'js/cards.js' %}" defer></script>
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">

    <!-- Botão Novo Orçamento -->
    {% if usuario.tipo == 'VENDEDOR' or usuario.tipo == 'ADMINISTRADOR' %}
    <div class="mb-8 flex justify-end">
        <a href="{% url 'upload_pdf' %}" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors">
            + Novo Orçamento
        </a>
    </div>
    {% endif %}

    <!-- Lista de Pedidos -->
    <div class="mb-8">

        {% if pedidos %}
        <div id="pedidos-container" class="card-grid">
            {% for pedido in pedidos %}
            <a href="{% url 'pedido_detalhe' pedido.id %}" class="card-link">
                <div class="card-modern fade-in"
                     data-pedido-id="{{ pedido.id }}"
                     data-pedido-status="{{ pedido.status }}"
                     data-card-status="{{ pedido.card_status }}"
                     data-vendedor-id="{{ pedido.vendedor_id }}">

                    <!-- Borda superior colorida baseada no card_status -->
                    <div class="card-border-top card-border-{{ pedido.card_status_css }}"
                         data-card-border></div>

                    <div class="card-content">
                        <!-- Header: Número do orçamento e Badge de Status -->
                        <div class="card-header">
                            <span class="card-number">#{{ pedido.numero_orcamento }}</span>
                            <span class="status-badge-modern badge-{{ pedido.card_status_css }}"
                                data-status>
                                {{ pedido.card_status_display }}
                            </span>
                        </div>

                        <!-- Divisor -->
                        <div class="card-divider"></div>

                        <!-- Informações do Pedido -->
                        <div class="card-info">
                            <p class="card-info-primary">{{ pedido.cliente }}</p>
                            <p class="card-info-item">
                                <span class="card-info-label">Vendedor:</span>
                                <span class="card-info-value">{{ pedido.vendedor }}</span>
                            </p>
                            <p class="card-info-item">
                                <span class="card-info-label">Logística:</span>
                                <span class="card-info-value">{{ pedido.logistica }}</span>
                            </p>
                            <p class="card-info-item card-info-value">
                                {{ pedido.embalagem }}
                            </p>
                        </div>

                        <!-- Badges de Separadores -->
                        {% if pedido.separadores %}
                        <div class="separator-badges-container">
                            {% for separador in pedido.separadores %}
                            <span class="separator-badge">{{ separador }}</span>
                            {% endfor %}
                        </div>
                        {% endif %}

                        <!-- Barra de Progresso -->
                        <div class="progress-container">
                            <div class="progress-wrapper">
                                <div class="progress-bar-bg">
                                    <div class="progress-bar-fill"
                                         style="width: {{ pedido.porcentagem_separacao|default:0 }}%"
                                         data-progress="{{ pedido.porcentagem_separacao|default:0 }}"></div>
                                </div>
                                <span class="progress-text">
                                    {{ pedido.porcentagem_separacao|default:0 }}%
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </a>
            {% endfor %}
        </div>
        {% else %}
        <div class="bg-gray-50 rounded-lg p-12 text-center">
            <svg class="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
            </svg>
            <h3 class="text-lg font-semibold text-gray-700 mb-2">Nenhum pedido ativo</h3>
            <p class="text-gray-500 mb-4">Não há pedidos pendentes ou em separação no momento.</p>
            {% if usuario.tipo == 'VENDEDOR' or usuario.tipo == 'ADMINISTRADOR' %}
            <a href="{% url 'upload_pdf' %}" class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors">
                + Criar Primeiro Pedido
            </a>
            {% endif %}
        </div>
        {% endif %}
    </div>

    <!-- Ações Rápidas (Fases Futuras) -->
    <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-xl font-semibold text-gray-800 mb-4">Acesso Rápido</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            {% if usuario.tipo == 'SEPARADOR' or usuario.tipo == 'ADMINISTRADOR' %}
            <a href="#" class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 opacity-50 cursor-not-allowed">
                <svg class="w-6 h-6 text-yellow-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
                </svg>
                <div>
                    <p class="font-semibold text-gray-900">Separação</p>
                    <p class="text-xs text-gray-500">FASE 5</p>
                </div>
            </a>
            {% endif %}

            {% if usuario.tipo == 'COMPRADORA' or usuario.tipo == 'ADMINISTRADOR' %}
            <a href="#" class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 opacity-50 cursor-not-allowed">
                <svg class="w-6 h-6 text-purple-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"/>
                </svg>
                <div>
                    <p class="font-semibold text-gray-900">Compras</p>
                    <p class="text-xs text-gray-500">FASE 6</p>
                </div>
            </a>
            {% endif %}

            {% if usuario.tipo == 'ADMINISTRADOR' %}
            <a href="#" class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 opacity-50 cursor-not-allowed">
                <svg class="w-6 h-6 text-red-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>
                </svg>
                <div>
                    <p class="font-semibold text-gray-900">Usuários</p>
                    <p class="text-xs text-gray-500">FASE 7</p>
                </div>
            </a>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
