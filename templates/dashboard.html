{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard - Sistema PMCELL{% endblock %}

{% block extra_head %}
<script src="{% static 'js/dashboard.js' %}" defer></script>
<script src="{% static 'js/cards.js' %}" defer></script>
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">

    <!-- Lista de Pedidos -->
    <div class="mb-8">

        {% if pedidos %}
        <div id="pedidos-container" class="card-grid">
            {% for pedido in pedidos %}
            <a href="{% url 'pedido_detalhe' pedido.id %}" class="card-link">
                <div class="card-modern fade-in"
                     data-pedido-id="{{ pedido.id }}"
                     data-pedido-status="{{ pedido.status }}"
                     data-card-status="{{ pedido.card_status }}"
                     data-criado-em="{{ pedido.criado_em }}"
                     data-vendedor-id="{{ pedido.vendedor_id }}">

                    <!-- Borda superior colorida baseada no card_status -->
                    <div class="card-border-top card-border-{{ pedido.card_status_css }}"
                         data-card-border></div>

                    <div class="card-content">
                        <!-- Header: Número do orçamento e Badge de Status -->
                        <div class="card-header">
                            <span class="card-number">#{{ pedido.numero_orcamento }}</span>
                            <span class="status-badge-modern badge-{{ pedido.card_status_css }}"
                                data-status>
                                {{ pedido.card_status_display }}
                            </span>
                        </div>

                        <!-- Divisor -->
                        <div class="card-divider"></div>

                        <!-- Informações do Pedido -->
                        <div class="card-info">
                            <p class="card-info-primary">{{ pedido.cliente }}</p>
                            <p class="card-info-item">
                                <span class="card-info-label">Vendedor:</span>
                                <span class="card-info-value">{{ pedido.vendedor }}</span>
                            </p>
                            <p class="card-info-item">
                                <span class="card-info-label">Logística:</span>
                                <span class="card-info-value">{{ pedido.logistica }}</span>
                            </p>
                            <p class="card-info-item card-info-value">
                                {{ pedido.embalagem }}
                            </p>
                        </div>

                        <!-- Badges de Separadores -->
                        {% if pedido.separadores %}
                        <div class="separator-badges-container">
                            {% for separador in pedido.separadores %}
                            <span class="separator-badge">{{ separador }}</span>
                            {% endfor %}
                        </div>
                        {% endif %}

                        <!-- Barra de Progresso -->
                        <div class="progress-container">
                            <div class="progress-wrapper">
                                <div class="progress-bar-bg">
                                    <div class="progress-bar-fill"
                                         style="width: {{ pedido.porcentagem_separacao|default:0 }}%"
                                         data-progress="{{ pedido.porcentagem_separacao|default:0 }}"></div>
                                </div>
                                <span class="progress-text">
                                    {{ pedido.porcentagem_separacao|default:0 }}%
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </a>
            {% endfor %}
        </div>
        {% else %}
        <div class="bg-gray-50 rounded-lg p-12 text-center">
            {% if empty_state_image_url %}
                <img src="{{ empty_state_image_url }}"
                     alt="Nenhum pedido"
                     class="w-32 h-32 mx-auto mb-4 object-contain">
            {% else %}
                <img src="{% static 'images/empty-state.svg' %}"
                     alt="Nenhum pedido"
                     class="w-32 h-32 mx-auto mb-4">
            {% endif %}
            <h3 class="text-lg font-semibold text-gray-700 mb-2">
                {{ empty_state_titulo }}
            </h3>
            <p class="text-gray-500 mb-4">
                {{ empty_state_subtitulo }}
            </p>
            {% if usuario.tipo == 'VENDEDOR' or usuario.tipo == 'ADMINISTRADOR' %}
            <a href="{% url 'upload_pdf' %}" class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors">
                + Criar Primeiro Pedido
            </a>
            {% endif %}
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
